# 错误码定义

本文档定义了系统中使用的所有错误码及其含义。

## 错误码格式

错误码为 5 位数字，格式为：`ABBCC`

- A: 错误类型

  - 1: 系统级错误
  - 2: 业务级错误
  - 3: 第三方服务错误
  - 4: 数据库错误
  - 5: 缓存错误

- BB: 模块编号

  - 00: 通用模块
  - 01: 用户模块
  - 02: 认证模块
  - 03: 授权模块
  - 04: 配置模块

- CC: 具体错误编号
  - 00-99: 具体错误编号

## 系统级错误 (1xxxx)

### 通用系统错误 (10000-10099)

| 错误码 | 错误信息       | HTTP 状态码 | 说明                 |
| ------ | -------------- | ----------- | -------------------- |
| 10000  | 系统内部错误   | 500         | 未知的系统错误       |
| 10001  | 服务暂时不可用 | 503         | 服务暂时无法处理请求 |
| 10002  | 请求超时       | 504         | 请求处理超时         |

### 参数验证错误 (10100-10199)

| 错误码 | 错误信息     | HTTP 状态码 | 说明               |
| ------ | ------------ | ----------- | ------------------ |
| 10100  | 参数验证失败 | 400         | 请求参数未通过验证 |
| 10101  | 参数类型错误 | 400         | 参数类型与预期不符 |
| 10102  | 必填参数缺失 | 400         | 缺少必需的参数     |

## 业务级错误 (2xxxx)

### 用户模块错误 (20100-20199)

| 错误码 | 错误信息   | HTTP 状态码 | 说明                 |
| ------ | ---------- | ----------- | -------------------- |
| 20100  | 用户未找到 | 404         | 指定的用户不存在     |
| 20101  | 用户已存在 | 409         | 尝试创建的用户已存在 |
| 20102  | 用户名无效 | 400         | 用户名格式不正确     |

### 认证模块错误 (20200-20299)

| 错误码 | 错误信息       | HTTP 状态码 | 说明                       |
| ------ | -------------- | ----------- | -------------------------- |
| 20200  | 未授权访问     | 401         | 用户未登录或 token 无效    |
| 20201  | 访问令牌过期   | 401         | 访问令牌已过期             |
| 20202  | 无效的访问令牌 | 401         | 访问令牌格式错误或签名无效 |

### 授权模块错误 (20300-20399)

| 错误码 | 错误信息     | HTTP 状态码 | 说明                     |
| ------ | ------------ | ----------- | ------------------------ |
| 20300  | 权限不足     | 403         | 用户没有执行该操作的权限 |
| 20301  | 超出访问限制 | 429         | 请求频率超出限制         |

## 第三方服务错误 (3xxxx)

### 外部 API 错误 (30000-30099)

| 错误码 | 错误信息       | HTTP 状态码 | 说明                     |
| ------ | -------------- | ----------- | ------------------------ |
| 30000  | 第三方服务异常 | 502         | 调用第三方服务时发生错误 |
| 30001  | 第三方服务超时 | 504         | 第三方服务响应超时       |

## 数据库错误 (4xxxx)

### 数据库操作错误 (40000-40099)

| 错误码 | 错误信息       | HTTP 状态码 | 说明                     |
| ------ | -------------- | ----------- | ------------------------ |
| 40000  | 数据库连接错误 | 500         | 无法连接到数据库         |
| 40001  | 数据库查询错误 | 500         | 执行数据库查询时发生错误 |
| 40002  | 数据不存在     | 404         | 请求的数据记录不存在     |

## 缓存错误 (5xxxx)

### 缓存操作错误 (50000-50099)

| 错误码 | 错误信息     | HTTP 状态码 | 说明               |
| ------ | ------------ | ----------- | ------------------ |
| 50000  | 缓存服务错误 | 500         | 缓存服务操作失败   |
| 50001  | 缓存键不存在 | 404         | 请求的缓存键不存在 |

## 错误响应示例

### 参数验证错误

```json
{
  "code": 10100,
  "message": "参数验证失败",
  "details": {
    "field": "username",
    "error": "长度必须在 3-20 个字符之间"
  }
}
```

### 认证错误

```json
{
  "code": 20200,
  "message": "未授权访问",
  "details": {
    "reason": "token已过期",
    "expire_time": "2023-06-01T12:00:00Z"
  }
}
```

### 业务错误

```json
{
  "code": 20100,
  "message": "用户未找到",
  "details": {
    "user_id": "12345"
  }
}
```
