version: v2
managed:
  enabled: true
  disable:
    - file_option: go_package
      module: buf.build/googleapis/googleapis
plugins:
 # --- 使用 BSR 远程插件 ---
  # 生成 Go Protobuf 结构体
  - remote: buf.build/protocolbuffers/go
    out: pkg/api
    opt: paths=source_relative
  # 生成 Go gRPC 代码
  - remote: buf.build/grpc/go
    out: pkg/api
    opt: paths=source_relative
  # 生成 gRPC-Gateway 反向代理
  - remote: buf.build/grpc-ecosystem/gateway
    out: pkg/api
    opt: paths=source_relative
  # 生成 OpenAPI 文档
  - remote: buf.build/grpc-ecosystem/openapiv2
    out: api/openapi
  # 本地插件，用于生成 Kratos HTTP 代码
  - local: protoc-gen-go-http
    out: pkg/api
    opt: paths=source_relative
  - local: protoc-gen-go-errors-code
    out: docs/guide/zh-CN/api/errors-code
    opt: paths=source_relative
  - local:  protoc-gen-validate
    out: pkg/api
    opt:
      - lang=go                  # 必需字段：指定目标语言
      - paths=source_relative
  - local: protoc-gen-deepcopy
    out: pkg/api
    opt:
      - paths=source_relative
  - local: protoc-gen-go-errors
    out: pkg/api
    opt:
      - paths=source_relative
inputs:
  - directory: pkg/api
    exclude_paths:  # 排除生成目录
      - "errors"
      - "google"
      - "validate"